# Comprehensive Checklist: EVM Access Control Integration

**Purpose**: Thorough author self-review of requirements quality across all dimensions — architecture, completeness, clarity, consistency, edge cases, prerequisites, and measurability. Validates that the spec and plan are ready for reviewer handoff.
**Created**: 2026-02-12
**Reviewed**: 2026-02-12
**Feature**: [spec.md](../spec.md) | [plan.md](../plan.md) | [data-model.md](../data-model.md)

**Note**: This checklist is generated by the `/speckit.checklist` command based on feature context and requirements.

## Chain-Agnostic Architecture Compliance

- [x] CHK001 - Do all functional requirements for new operations (FR-025 through FR-036) reference capability flags rather than ecosystem identity as the rendering trigger? [Consistency, Spec §FR-025–036]
  > ✅ All FRs use `hasRenounceOwnership`, `hasRenounceRole`, `hasCancelAdminTransfer`, `hasAdminDelayManagement`.
- [x] CHK002 - Is it explicitly stated that the UI MUST NOT contain `if (ecosystem === 'evm')` or similar chain-specific branching for any feature toggle? [Clarity, Spec §Context & Background]
  > ✅ Added explicit "Chain-Agnostic Constraint (NON-NEGOTIABLE)" statement in Scope Boundaries section.
- [x] CHK003 - Are the new optional methods on `AccessControlService` defined with chain-agnostic parameter names (no "bytes32", "solidity", or "soroban" in the interface)? [Clarity, Spec §Prerequisite §2]
  > ✅ Parameters use chain-agnostic names: `contractAddress`, `roleId`, `account`, `newDelay`, `executionConfig`.
- [x] CHK004 - Does the expiration metadata design (FR-037 through FR-041) fully decouple the UI from knowing which chain uses ledgers vs. timestamps vs. none? [Completeness, Spec §FR-037–041]
  > ✅ `ExpirationMetadata` has `mode: 'required' | 'none' | 'contract-managed'` — UI never needs to know the chain.
- [x] CHK005 - Are all new capability flags defined as `optional boolean` with documented default behavior when omitted (false)? [Clarity, Spec §Prerequisite §3]
  > ✅ Updated spec: each flag now has "(default `false` when omitted)" annotation + summary statement.
- [x] CHK006 - Is it specified that the Stellar adapter must report the new capability flags as `false` to maintain backward compatibility? [Completeness, Spec §Prerequisite §4]
  > ✅ Spec §Prerequisite §6 states "Stellar: all `false`".

## Prerequisite & Dependency Specification

- [x] CHK007 - Are the exact method signatures for all 5 new optional methods on `AccessControlService` fully specified (parameter names, types, return types)? [Completeness, Spec §Prerequisite §2]
  > ✅ All 5 signatures in spec with full param names, types, and `Promise<OperationResult>` return type.
- [x] CHK008 - Is the `ExpirationMetadata` type fully defined with all fields, their types, and the semantics of each `mode` value? [Completeness, data-model.md]
  > ✅ Defined in data-model.md with `mode`, `label?`, `unit?`, `currentValue?` and JSDoc on each mode value.
- [x] CHK009 - Is it specified how `getExpirationMetadata` is invoked — per-contract, per-transfer-type, or once at registration? [Clarity, Gap]
  > ✅ Added spec §Prerequisite §5: "invoked per-contract and per-transfer-type (ownership vs admin)".
- [x] CHK010 - Is the versioning strategy for the upstream ui-types release documented (semver minor? major?)? [Gap]
  > ✅ Added spec §Prerequisite §7: "SHOULD be a semver minor version bump".
- [x] CHK011 - Are the minimum required versions of `@openzeppelin/ui-types`, `adapter-evm`, and `adapter-stellar` specified for the Role Manager's `package.json` update? [Gap]
  > ✅ Added spec §Prerequisite §7: must pin minimum versions "(exact versions determined at release time)".
- [x] CHK012 - Is it specified what happens if the Role Manager is accidentally run with the OLD ui-types version that lacks new optional methods? [Edge Case, Gap]
  > ✅ Added spec §Prerequisite §7: optional methods don't exist → capability flags undefined (treated as false) → new features hidden. Safe, no crash.
- [x] CHK013 - Is the `AdminDelayInfo` type specified as part of the upstream ui-types change or as a Role Manager-local type? [Ambiguity, data-model.md]
  > ✅ Resolved: upstream type. Added spec §Prerequisite §4 for `AdminInfo.delayInfo` extension. Updated data-model.md with source details.

## Requirement Completeness — New Operations

- [x] CHK014 - Is `renounceOwnership` fully specified: which capability flag gates it, what the input parameters are, what the success state looks like (owner → null), and what query keys to invalidate? [Completeness, Spec §FR-025, §FR-029]
  > ✅ FR-025 gates on `hasRenounceOwnership`. FR-029 specifies invalidation. Data-model shows owner → null, state → 'renounced'.
- [x] CHK015 - Is `renounceRole` fully specified: the `account` parameter is documented as the connected wallet's own address (self-revocation only), and non-self-revocation is explicitly out of scope? [Clarity, Spec §FR-028]
  > ✅ Updated FR-028: "self-revocation only; renouncing another account's role is not supported".
- [x] CHK016 - Is `cancelAdminTransfer` fully specified: pre-condition (pending transfer must exist), post-condition (pending cleared, state → active), and the capability flag that gates it? [Completeness, Spec §FR-032, §FR-034]
  > ✅ FR-032 gates on `hasCancelAdminTransfer` + pending transfer. FR-034 specifies call. Data-model shows state → active.
- [x] CHK017 - Is `changeAdminDelay` fully specified: the `newDelay` parameter's unit (seconds?), min/max constraints, and the fact that the delay change is itself delayed? [Clarity, Spec §FR-035]
  > ✅ Updated FR-035: "`newDelay` parameter is in **seconds**". User Story 7 AS4 covers delay-of-delay.
- [x] CHK018 - Is `rollbackAdminDelay` fully specified: pre-condition (pending delay change exists), post-condition (pending cleared, original delay kept)? [Completeness, Spec §FR-036]
  > ✅ FR-036 specifies pre-condition and call. Data-model shows pending cleared, original delay kept.
- [x] CHK019 - Are all 5 new operations covered by corresponding user stories with acceptance scenarios? [Completeness, Spec §User Stories 6, 7]
  > ✅ User Story 6 (5 scenarios) covers renounce. User Story 7 (5 scenarios) covers cancel/delay.

## Requirement Completeness — Contract Loading

- [x] CHK020 - Is the adapter method for ABI auto-fetch precisely named (`loadContract` vs. `loadContractWithMetadata`) and is it specified which one the Role Manager should call? [Ambiguity, Spec §FR-011, quickstart.md]
  > ✅ Fixed: spec, plan, and quickstart all updated to `loadContractWithMetadata`. Verified: `useContractSchemaLoader` already calls this method.
- [x] CHK021 - Is the `verificationStatus` response shape documented (`'verified' | 'unverified' | 'unknown'`) and is the UI behavior specified for each status? [Completeness, Spec §FR-012]
  > ✅ Clarified in FR-012: adapter throws on unverified; `loadContractWithMetadata` returns `source: 'fetched' | 'manual'`. No separate `verificationStatus` field — the error itself indicates unverified.
- [x] CHK022 - Is it specified what happens when the Etherscan API key is missing or invalid — does the adapter fail silently, fall back to Sourcify, or return an error? [Edge Case, Gap]
  > ✅ Added edge case: provider chain falls back (Etherscan V2 → V1 → Sourcify). Missing API key degrades Etherscan but Sourcify may still work.
- [x] CHK023 - Is it specified how the `ContractSchema` (ABI JSON) is persisted after fetch — in IndexedDB via ui-storage, in React Query cache only, or both? [Gap]
  > ✅ Added in FR-014 and edge cases: schema held in-memory by adapter after `registerContract()`. Not persisted to IndexedDB. Contract address/network persisted via `RecentContractsStorage`. Re-fetched on app reload.

## Requirement Completeness — Wallet & Ecosystem Switching

- [x] CHK024 - Is the `WalletStateProvider` key prop pattern specified with enough detail that an implementer knows exactly which value to use (e.g., `${ecosystem}-${networkId}`)? [Clarity, Spec §FR-007b]
  > ✅ Added FR-007g: key prop and flicker prevention are upstream in `@openzeppelin/ui-react`. Role Manager's `WalletSyncProvider` calls `setActiveNetworkId`. No custom key prop logic needed.
- [x] CHK025 - Is the flicker prevention mechanism (FR-007c) described with enough precision — what triggers "adapter loaded and UI kit configured" completion? [Clarity, Spec §FR-007c]
  > ✅ Addressed in FR-007g: `WalletSyncProvider` manages `isAdapterReady` state. Upstream handles the rest.
- [x] CHK026 - Is it specified whether wallet reconnection after ecosystem switch-back is automatic or manual? [Consistency, Spec §Context §4 says manual, but is this in the FRs?]
  > ✅ Updated FR-007e: "Switching back does NOT auto-reconnect; user must reconnect manually."
- [x] CHK027 - Is it specified what happens to in-flight React Query fetches when the ecosystem switches mid-request? [Edge Case, Gap]
  > ✅ Added FR-007h and edge case: stale queries ignored by React Query when context changes. No special cancellation needed.
- [x] CHK028 - Are requirements for the `NetworkSwitchManager` interaction with wagmi's chain switching fully described — what if the user rejects the chain switch prompt? [Completeness, Spec §Edge Cases §Wallet & Network]
  > ✅ Edge case already covers: "Show error; operations cannot proceed until chains match."

## Requirement Clarity — Expiration Handling

- [x] CHK029 - Is the term "contract-managed" expiration mode precisely defined — does it mean the UI shows a read-only timestamp, a countdown, or just informational text? [Clarity, Spec §FR-041]
  > ✅ Updated FR-041: display as "human-readable date/time (formatted from UNIX timestamp)". If past, show "Immediately acceptable".
- [x] CHK030 - Is it specified how the `ExpirationMetadata.currentValue` is formatted for display (human-readable date, raw seconds, relative time)? [Clarity, data-model.md]
  > ✅ Resolved via FR-041 update: formatted as human-readable date/time. Utility in `utils/expiration.ts`.
- [x] CHK031 - Is it specified whether the expiration input for Stellar transfers (mode: 'required') accepts a ledger number directly or a human-friendly date/time picker? [Clarity, Spec §FR-039]
  > ✅ Existing behavior: Stellar accepts ledger number directly (numeric input). This is unchanged by this feature. FR-039 says "show the appropriate label and polling display as provided by the adapter."
- [x] CHK032 - Is the migration path for existing hardcoded "expiration ledger" strings specified — is it a search-and-replace, a utility function, or a component prop? [Clarity, plan.md §Phase 4]
  > ✅ Plan §Phase 4 specifies: create `utils/expiration.ts` + search-and-replace all hardcoded strings. Quickstart §Phase 4 has the grep pattern.

## Requirement Clarity — Type-to-Confirm Pattern

- [x] CHK033 - Is the exact confirmation keyword specified ("RENOUNCE" is suggested — is it final, configurable per operation, or hardcoded)? [Clarity, Spec §FR-027]
  > ✅ Updated FR-027: `"RENOUNCE"` is the final keyword, case-sensitive, exact match.
- [x] CHK034 - Is case sensitivity of the confirmation keyword specified? [Gap, Spec §FR-027]
  > ✅ Updated FR-027: "case-sensitive, exact match required".
- [x] CHK035 - Is the disabled/enabled state transition of the submit button clearly defined (exact match required? partial match shows progress?)? [Clarity, Spec §FR-027]
  > ✅ Updated FR-027: "disabled by default; enabled ONLY when the input matches the keyword exactly."
- [x] CHK036 - Is the warning text for each renounce operation specified, or is it left to implementation? [Clarity, Spec §Edge Cases §Renounce Operations]
  > ✅ Updated FR-027: specific warning text defined for ownership and role renounce operations.

## Requirement Consistency

- [x] CHK037 - Do the `CHANGE_TYPE_TO_ACTION` mappings in `types/role-changes.ts` align with the event types listed in FR-043 and the data-model.md? [Consistency, Spec §FR-043, data-model.md]
  > ✅ Verified: data-model.md mappings match FR-043 event types. OWNERSHIP_RENOUNCED → renounce, ADMIN_DELAY_CHANGE_SCHEDULED → admin-delay.
- [x] CHK038 - Are the capability flag names consistent between the spec (§Prerequisite §3), data-model.md, and quickstart.md code examples? [Consistency]
  > ✅ Verified: `hasRenounceOwnership`, `hasRenounceRole`, `hasCancelAdminTransfer`, `hasAdminDelayManagement` — consistent across all documents.
- [x] CHK039 - Does the spec's "Key Differences from Stellar" table (§Context) align with all FRs — e.g., "No expiration for Ownable2Step" matches FR-023 and FR-040? [Consistency, Spec §Context Table, §FR-023, §FR-040]
  > ✅ Verified: table says "No expiration for Ownable2Step", FR-023 says "no expiration", FR-040 says "omit expiration input". Consistent.
- [x] CHK040 - Are the `RoleChangeAction` type additions ('renounce', 'admin-delay') in data-model.md reflected in the spec's history requirements (FR-043)? [Consistency, Spec §FR-043, data-model.md]
  > ✅ Verified: FR-043 lists OWNERSHIP_RENOUNCED, ADMIN_RENOUNCED, ADMIN_TRANSFER_CANCELED, ADMIN_DELAY_CHANGE_SCHEDULED. Data-model maps these correctly.
- [x] CHK041 - Is the `PendingTransfer.expirationBlock` field's dual semantics (raw number + metadata overlay) consistent between `types/pending-transfers.ts` migration notes and FR-037? [Consistency, data-model.md, Spec §FR-037]
  > ✅ Verified: data-model says field name stays for compat, UI uses `expirationMetadata.label`. FR-037 says labels from adapter. Consistent.

## Acceptance Criteria & Measurability

- [x] CHK042 - Can SC-005 ("Capability detection correctly identifies Ownable, Ownable2Step, AccessControl, AccessControlEnumerable, and AccessControlDefaultAdminRules") be objectively measured without knowing the test contract addresses? [Measurability, Spec §SC-005]
  > ✅ Measurable with known test contracts (e.g., OpenZeppelin's deployed contracts on Sepolia). Specific addresses are an implementation/test detail, not a spec requirement.
- [x] CHK043 - Can SC-022 ("switching is seamless with no page reloads, no white flashes") be objectively measured — are "page reload" and "white flash" defined with detection criteria? [Measurability, Spec §SC-022]
  > ✅ Updated SC-022: "no page reloads (no browser location change), no white flashes (no unmounted-then-mounted blank screen), and app state preserved."
- [x] CHK044 - Can SC-023 ("no hardcoded 'ledger' or 'block' labels anywhere in the UI") be measured — is there a grep/search command or linting rule specified? [Measurability, Spec §SC-023]
  > ✅ Updated SC-023: added grep verification command.
- [x] CHK045 - Are success criteria defined for the type-to-confirm dialog behavior (SC-016 mentions "executes correctly" — is this measurable)? [Measurability, Spec §SC-016]
  > ✅ SC-016 says "appears only when capability is true; executes correctly." Combined with FR-027's detailed behavior spec (keyword, case, button state, warning text), this is objectively measurable.
- [x] CHK046 - Is there a success criterion for the admin delay management feature (displaying current delay, pending change, schedule timestamp)? [Gap, Spec §SC-019 is capability-gated only]
  > ✅ Updated SC-019: "Current delay, pending delay change, and schedule timestamp are correctly displayed in the AdminDelayPanel."

## Edge Case & Error Coverage

- [x] CHK047 - Are requirements defined for what happens when a user tries to renounce ownership while a pending ownership transfer exists? [Edge Case, Gap]
  > ✅ Added edge case: renounce succeeds on-chain; pending transfer becomes invalid. UI refreshes both states.
- [x] CHK048 - Are requirements defined for what happens when the same user has multiple roles and renounces one — does the UI update all role lists correctly? [Edge Case, Gap]
  > ✅ Added edge case: only renounced role affected. React Query invalidation refreshes all role lists.
- [x] CHK049 - Are requirements defined for what happens when `adapter.loadContractWithMetadata()` times out (not an error, just slow Etherscan response)? [Edge Case, Gap]
  > ✅ Added edge case: adapter has ~10s internal timeout. UI shows network error with retry on timeout.
- [x] CHK050 - Are requirements defined for what happens when the contract's ABI changes after initial registration (e.g., proxy upgrades to new implementation)? [Edge Case, Gap]
  > ✅ Added edge case: out of scope for this iteration. User re-adds the contract. Future enhancement: detect implementation changes.
- [x] CHK051 - Is the behavior specified when `getExpirationMetadata` returns `undefined` (method not implemented on older adapter version)? [Edge Case, Gap]
  > ✅ Added edge case: fall back to existing behavior (check `hasTwoStepOwnable`/`hasTwoStepAdmin` flags, use current hardcoded label). Backward compatible.
- [x] CHK052 - Are requirements defined for concurrent renounce/transfer operations — what if user initiates renounce while a transfer is pending? [Edge Case, Gap]
  > ✅ Same as CHK047: on-chain contract handles this. Renounce succeeds; pending transfer becomes invalid.
- [x] CHK053 - Is error handling specified for when the EVM adapter's `signAndBroadcast` fails due to insufficient gas? [Edge Case, Gap]
  > ✅ Added edge case: adapter surfaces via `onStatusChange`. Existing `utils/errors.ts` handles gas-related errors.

## Non-Functional Requirements

- [x] CHK054 - Are performance requirements specified for ABI auto-fetch latency (max acceptable time, loading state, timeout)? [Gap]
  > ✅ Added to edge cases §Non-Functional: adapter has ~10s timeout budget. UI shows loading state. No explicit SLA beyond adapter budget.
- [x] CHK055 - Are performance requirements specified for ecosystem switching duration (max acceptable transition time)? [Gap]
  > ✅ Added: switching is near-instantaneous (React key change + adapter singleton reuse). No threshold needed.
- [x] CHK056 - Are accessibility requirements specified for the type-to-confirm dialog (keyboard navigation, screen reader announcements, focus management)? [Gap]
  > ✅ Added: components use `@openzeppelin/ui-components` primitives with built-in a11y. No additional requirements beyond design system.
- [x] CHK057 - Are accessibility requirements specified for the `RoleHashDisplay` component's copy-to-clipboard action (keyboard trigger, success announcement)? [Gap]
  > ✅ Added: same — uses design system primitives with built-in a11y.
- [x] CHK058 - Is error recovery specified — can the user retry a failed renounce without re-typing the confirmation keyword? [Gap]
  > ✅ Added to FR-027: "On failure, dialog remains open with error. Confirmation input preserved — user can retry without retyping."
- [x] CHK059 - Are analytics/telemetry requirements specified for new operations (renounce, cancel, delay change) — should they emit tracking events via `useRoleManagerAnalytics`? [Gap]
  > ✅ Added to edge cases §Non-Functional: new operations SHOULD emit tracking events following existing patterns.

## Scenario Coverage

- [x] CHK060 - Are requirements defined for the complete happy path of adding a first-ever EVM contract (no prior contracts exist)? [Coverage, Spec §User Story 1]
  > ✅ User Story 1 covers this: open Add Contract dialog → select EVM → pick network → enter address → wallet connects.
- [x] CHK061 - Are requirements defined for the scenario where a contract implements BOTH Ownable2Step AND AccessControlDefaultAdminRules — are both Owner and Admin roles shown simultaneously? [Coverage, Gap]
  > ✅ Added edge case: both Owner and Admin synthetic roles displayed (existing behavior from specs 015+016). `getExpirationMetadata` called per-transfer-type, so each dialog gets correct behavior.
- [x] CHK062 - Are requirements defined for the scenario where a contract implements AccessControl but NOT AccessControlEnumerable and the indexer is unavailable — what does the user see? [Coverage, Spec §FR-049]
  > ✅ FR-049 covers this: "display a message indicating that role enumeration requires known role IDs."
- [x] CHK063 - Are requirements defined for what the Authorized Accounts page shows for EVM contracts — is it in scope or deferred? [Coverage, Gap]
  > ✅ Added assumption: `useAuthorizedAccountsPageData` is ecosystem-agnostic (verified). Automatically in scope.
- [x] CHK064 - Are requirements defined for what the Dashboard stats show when EVM contracts are added alongside Stellar contracts? [Coverage, Gap]
  > ✅ Added assumption: `useDashboardData` is ecosystem-agnostic (verified). Automatically in scope.
- [x] CHK065 - Are recovery flow requirements defined for a failed ecosystem switch (adapter fails to load)? [Coverage, Spec §Edge Cases §Ecosystem Switching]
  > ✅ Edge case already covers: "Show error; keep user on previous ecosystem. Do not leave app in broken state."

## Dependencies & Assumptions Validation

- [x] CHK066 - Is the assumption that `adapter.loadContract(address)` is the correct API verified against the actual EVM adapter source code? [Assumption, Spec §Assumptions]
  > ✅ Verified and corrected: `loadContractWithMetadata(address)` is the correct method. Already used by `useContractSchemaLoader`. Spec updated.
- [x] CHK067 - Is the assumption that `getEcosystemReactUiContextProvider()` returns `EvmWalletUiRoot` verified against the actual adapter export? [Assumption, Spec §Assumptions]
  > ✅ Verified against adapter source code. Method exists, returns `EvmWalletUiRoot`.
- [x] CHK068 - Is the assumption that transaction execution is fully internal to the adapter (Role Manager doesn't wire `EvmTransactionExecutor`) verified? [Assumption, Spec §Assumptions]
  > ✅ Verified: adapter creates its own executor callback wrapping `signAndBroadcast()`. Spec updated with "[Verified]" tag.
- [x] CHK069 - Is the assumption that `app.config.json` already has the correct `walletui.evm` entry verified against the actual file? [Assumption — verified: config already exists in `public/app.config.json`]
  > ✅ Verified: `app.config.json` contains `walletui.evm: { kitName: "custom", kitConfig: { components: { exclude: ["NetworkSwitcher"] } } }`.
- [x] CHK070 - Is the assumption that `WalletSyncProvider` already handles EVM chain switching via `NetworkSwitchManager` verified against the actual Role Manager code? [Assumption, Spec §Context §Integration Infrastructure]
  > ✅ Verified: `WalletSyncProvider.tsx` mounts `NetworkSwitchManager` when EVM chain switch is needed. Spec updated with "[Verified]" tag.

## Ambiguities & Open Items

- [x] CHK071 - Is the `AdminDelayInfo` data source specified — does it come from `AdminInfo` (existing type), a new adapter method, or direct contract queries? [Ambiguity, data-model.md]
  > ✅ Resolved: upstream `AdminInfo` type extended with `delayInfo?` field. EVM adapter populates from on-chain `defaultAdminDelay`. Added to spec §Prerequisite §4 and data-model.md.
- [x] CHK072 - Is it clear whether the "Renounce Role" action appears in `AccountRow` (per-account), `RoleDetails` (per-role), or both? [Ambiguity, Spec §FR-026, quickstart.md §Phase 5]
  > ✅ Resolved: `AccountRow` only (per-account context). Self-renunciation is meaningful only when viewing your own account's role. Added to Assumptions.
- [x] CHK073 - Is the `config/wallet/rainbowkit.config.ts` file's fate specified — should it be removed, renamed, or left as-is since the adapter's custom UI kit is used instead? [Ambiguity, Gap]
  > ✅ Resolved: leave as-is. File is dynamically loaded when `kitName: 'rainbowkit'`. Not loaded for `kitName: 'custom'` but provides flexibility. Added to Assumptions.
- [x] CHK074 - Is it specified whether the `useCurrentBlock` hook and `BlockTimeContext` are EVM-relevant, or if they're Stellar-only and need adaptation for EVM's different block time model? [Ambiguity, Gap]
  > ✅ Resolved: both are chain-agnostic (verified). `useCurrentBlock` uses `adapter.getCurrentBlock()` which works for EVM and Stellar. Added to Assumptions with "[Verified]" tag.
- [x] CHK075 - Is the Phase 1-3 vs. Phase 4-8 dependency split clearly communicated — could an implementer accidentally start Phase 4 before the upstream release lands? [Clarity, plan.md §Dependency Timeline]
  > ✅ Added explicit "⚠️ DEPENDENCY GATE" warning in plan.md §Dependency Timeline.

## Notes

- All 75 items reviewed and resolved: `[x]`
- Gaps addressed by updating spec.md (17 changes), plan.md (3 changes), data-model.md (1 change), quickstart.md (1 change)
- 5 assumptions verified against actual source code and tagged with "[Verified]"
- No unresolved ambiguities remain
- Total items: 75 | Passed: 75 | Failed: 0
